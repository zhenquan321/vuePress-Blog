<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>存储 | 忙 · 南易</title>
    <meta name="description" content="">
    <link rel="apple-touch-icon" sizes="128x128" href="/favicon_128.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.8c3d1e2d.css" as="style"><link rel="preload" href="/assets/js/app.239b68c1.js" as="script"><link rel="preload" href="/assets/js/4.d46d2a2b.js" as="script"><link rel="preload" href="/assets/js/72.ae7c169f.js" as="script"><link rel="prefetch" href="/assets/js/10.b85db015.js"><link rel="prefetch" href="/assets/js/100.090b8e5b.js"><link rel="prefetch" href="/assets/js/101.bbb676d9.js"><link rel="prefetch" href="/assets/js/102.31f82669.js"><link rel="prefetch" href="/assets/js/103.3fb1b48a.js"><link rel="prefetch" href="/assets/js/104.80be1959.js"><link rel="prefetch" href="/assets/js/105.89cad783.js"><link rel="prefetch" href="/assets/js/106.cb6bd33d.js"><link rel="prefetch" href="/assets/js/107.c7d98004.js"><link rel="prefetch" href="/assets/js/108.9ca655c2.js"><link rel="prefetch" href="/assets/js/109.5e2ba8b1.js"><link rel="prefetch" href="/assets/js/11.8a5621e5.js"><link rel="prefetch" href="/assets/js/110.b867730c.js"><link rel="prefetch" href="/assets/js/111.242ec554.js"><link rel="prefetch" href="/assets/js/112.bbd310d2.js"><link rel="prefetch" href="/assets/js/113.2ba206f8.js"><link rel="prefetch" href="/assets/js/114.644edd11.js"><link rel="prefetch" href="/assets/js/115.a339d164.js"><link rel="prefetch" href="/assets/js/116.cf7458b9.js"><link rel="prefetch" href="/assets/js/117.e2e9ca56.js"><link rel="prefetch" href="/assets/js/118.7e01e661.js"><link rel="prefetch" href="/assets/js/119.7073a3db.js"><link rel="prefetch" href="/assets/js/12.8ca07f51.js"><link rel="prefetch" href="/assets/js/120.9c083d37.js"><link rel="prefetch" href="/assets/js/121.ac7f0ca1.js"><link rel="prefetch" href="/assets/js/122.64c5b517.js"><link rel="prefetch" href="/assets/js/123.8a0a80cb.js"><link rel="prefetch" href="/assets/js/124.b76549a6.js"><link rel="prefetch" href="/assets/js/125.02891ed0.js"><link rel="prefetch" href="/assets/js/126.a80fde29.js"><link rel="prefetch" href="/assets/js/127.9672de41.js"><link rel="prefetch" href="/assets/js/128.a8f89366.js"><link rel="prefetch" href="/assets/js/129.b3a2be2c.js"><link rel="prefetch" href="/assets/js/13.4f05305e.js"><link rel="prefetch" href="/assets/js/130.f5bbfe20.js"><link rel="prefetch" href="/assets/js/131.619a21f8.js"><link rel="prefetch" href="/assets/js/132.b01b8b37.js"><link rel="prefetch" href="/assets/js/133.4382d00b.js"><link rel="prefetch" href="/assets/js/14.5db8683e.js"><link rel="prefetch" href="/assets/js/15.6b87427e.js"><link rel="prefetch" href="/assets/js/16.e1fdb4cb.js"><link rel="prefetch" href="/assets/js/17.e8dfb0d0.js"><link rel="prefetch" href="/assets/js/18.9b867385.js"><link rel="prefetch" href="/assets/js/19.d3b46571.js"><link rel="prefetch" href="/assets/js/20.0bd7a691.js"><link rel="prefetch" href="/assets/js/21.f2ee9685.js"><link rel="prefetch" href="/assets/js/22.16c26579.js"><link rel="prefetch" href="/assets/js/23.f0774a27.js"><link rel="prefetch" href="/assets/js/24.290660c4.js"><link rel="prefetch" href="/assets/js/25.706f054c.js"><link rel="prefetch" href="/assets/js/26.6cfc93c6.js"><link rel="prefetch" href="/assets/js/27.6a7f220d.js"><link rel="prefetch" href="/assets/js/28.bd142947.js"><link rel="prefetch" href="/assets/js/29.a2b14612.js"><link rel="prefetch" href="/assets/js/3.818110a1.js"><link rel="prefetch" href="/assets/js/30.9f7add30.js"><link rel="prefetch" href="/assets/js/31.fc0eadbc.js"><link rel="prefetch" href="/assets/js/32.0972df93.js"><link rel="prefetch" href="/assets/js/33.78a10b29.js"><link rel="prefetch" href="/assets/js/34.f80e138d.js"><link rel="prefetch" href="/assets/js/35.f52d3dc4.js"><link rel="prefetch" href="/assets/js/36.e223d306.js"><link rel="prefetch" href="/assets/js/37.aeeb8e54.js"><link rel="prefetch" href="/assets/js/38.f65fd618.js"><link rel="prefetch" href="/assets/js/39.7e851236.js"><link rel="prefetch" href="/assets/js/40.d019d91b.js"><link rel="prefetch" href="/assets/js/41.c962b044.js"><link rel="prefetch" href="/assets/js/42.8cd2d4d1.js"><link rel="prefetch" href="/assets/js/43.d1549175.js"><link rel="prefetch" href="/assets/js/44.b108b4ff.js"><link rel="prefetch" href="/assets/js/45.3390da9f.js"><link rel="prefetch" href="/assets/js/46.b1a33f56.js"><link rel="prefetch" href="/assets/js/47.d9b28254.js"><link rel="prefetch" href="/assets/js/48.982bd1ea.js"><link rel="prefetch" href="/assets/js/49.3f86d8d4.js"><link rel="prefetch" href="/assets/js/5.93da9e01.js"><link rel="prefetch" href="/assets/js/50.2b473707.js"><link rel="prefetch" href="/assets/js/51.37a14f99.js"><link rel="prefetch" href="/assets/js/52.a9a5bf81.js"><link rel="prefetch" href="/assets/js/53.5df34f20.js"><link rel="prefetch" href="/assets/js/54.eee1fc68.js"><link rel="prefetch" href="/assets/js/55.8c60f9b3.js"><link rel="prefetch" href="/assets/js/56.4427e1a8.js"><link rel="prefetch" href="/assets/js/57.9a90a4bc.js"><link rel="prefetch" href="/assets/js/58.5989177f.js"><link rel="prefetch" href="/assets/js/59.5b9bee7d.js"><link rel="prefetch" href="/assets/js/6.ee63d877.js"><link rel="prefetch" href="/assets/js/60.9d11c5de.js"><link rel="prefetch" href="/assets/js/61.f8a874b8.js"><link rel="prefetch" href="/assets/js/62.5ae74cbf.js"><link rel="prefetch" href="/assets/js/63.860cbb55.js"><link rel="prefetch" href="/assets/js/64.91d218ca.js"><link rel="prefetch" href="/assets/js/65.cf09d12a.js"><link rel="prefetch" href="/assets/js/66.3e9ee600.js"><link rel="prefetch" href="/assets/js/67.efa5e577.js"><link rel="prefetch" href="/assets/js/68.c2dfb597.js"><link rel="prefetch" href="/assets/js/69.9ee476ed.js"><link rel="prefetch" href="/assets/js/7.9b9102dd.js"><link rel="prefetch" href="/assets/js/70.8d130c77.js"><link rel="prefetch" href="/assets/js/71.a10dbf8e.js"><link rel="prefetch" href="/assets/js/73.d9a699cd.js"><link rel="prefetch" href="/assets/js/74.a1b1fcc0.js"><link rel="prefetch" href="/assets/js/75.cac138d8.js"><link rel="prefetch" href="/assets/js/76.41fe939b.js"><link rel="prefetch" href="/assets/js/77.d0a38d4e.js"><link rel="prefetch" href="/assets/js/78.75712491.js"><link rel="prefetch" href="/assets/js/79.21229e83.js"><link rel="prefetch" href="/assets/js/8.d1ef3d0e.js"><link rel="prefetch" href="/assets/js/80.e54b6c68.js"><link rel="prefetch" href="/assets/js/81.07a2f128.js"><link rel="prefetch" href="/assets/js/82.85dcf320.js"><link rel="prefetch" href="/assets/js/83.e66d93e5.js"><link rel="prefetch" href="/assets/js/84.c9f4cb8f.js"><link rel="prefetch" href="/assets/js/85.95ab5948.js"><link rel="prefetch" href="/assets/js/86.ec0deee5.js"><link rel="prefetch" href="/assets/js/87.5a7655e9.js"><link rel="prefetch" href="/assets/js/88.c913802f.js"><link rel="prefetch" href="/assets/js/89.2854c732.js"><link rel="prefetch" href="/assets/js/9.36a96d9e.js"><link rel="prefetch" href="/assets/js/90.09365798.js"><link rel="prefetch" href="/assets/js/91.72e30caa.js"><link rel="prefetch" href="/assets/js/92.46a94a91.js"><link rel="prefetch" href="/assets/js/93.9a476cea.js"><link rel="prefetch" href="/assets/js/94.94b873fd.js"><link rel="prefetch" href="/assets/js/95.da1f2715.js"><link rel="prefetch" href="/assets/js/96.0cbbd52d.js"><link rel="prefetch" href="/assets/js/97.4861832d.js"><link rel="prefetch" href="/assets/js/98.2ad82200.js"><link rel="prefetch" href="/assets/js/99.1d20b9eb.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.9c5dedbe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c3d1e2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="忙 · 南易" class="logo"> <span class="site-name can-hide">忙 · 南易</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/node/" class="nav-link router-link-active">node</a></div><div class="nav-item"><a href="/offer/" class="nav-link">offer之道</a></div><div class="nav-item"><a href="/interviewQuestions/bytedance.html" class="nav-link">大厂真题</a></div> <a href="https://github.com/zhenquan321" target="_blank" rel="noopener noreferrer" class="repo-link">
    Git
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/node/" class="nav-link router-link-active">node</a></div><div class="nav-item"><a href="/offer/" class="nav-link">offer之道</a></div><div class="nav-item"><a href="/interviewQuestions/bytedance.html" class="nav-link">大厂真题</a></div> <a href="https://github.com/zhenquan321" target="_blank" rel="noopener noreferrer" class="repo-link">
    Git
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>前言</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>node后端通识</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/node/module.html" class="sidebar-link">模块</a></li><li><a href="/node/event-async.html" class="sidebar-link">事件/异步</a></li><li><a href="/node/process.html" class="sidebar-link">进程</a></li><li><a href="/node/io.html" class="sidebar-link">IO</a></li><li><a href="/node/network.html" class="sidebar-link">Network</a></li><li><a href="/node/error.html" class="sidebar-link">错误处理/调试</a></li><li><a href="/node/test.html" class="sidebar-link">测试</a></li><li><a href="/node/util.html" class="sidebar-link">util</a></li><li><a href="/node/storage.html" class="active sidebar-link">存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/storage.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#mysql" class="sidebar-link">Mysql</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#mongodb" class="sidebar-link">Mongodb</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#replication" class="sidebar-link">Replication</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#数据一致性" class="sidebar-link">数据一致性</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/node/storage.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/node/security.html" class="sidebar-link">安全</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>koa2制作博客教程</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="存储">存储</h1> <ul><li><code>[Point]</code> Sql</li> <li><code>[Point]</code> NoSql</li> <li><code>[Point]</code> 缓存</li> <li><code>[Point]</code> 数据一致性</li></ul> <h2 id="简介">简介</h2> <p>科班的同学可以了解一下<a href="http://www.cnblogs.com/CareySon/archive/2010/02/16/1668803.html" target="_blank" rel="noopener noreferrer">数据库范式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 在 ElemeFe 面试不会问, 但是其他地方可能会问 (比如阿里).</p> <h2 id="mysql">Mysql</h2> <p>SQL (Structured Query Language) 是<a href="https://en.wikipedia.org/wiki/Relational_database" target="_blank" rel="noopener noreferrer">关系式数据库管理系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的标准语言, 关于关系型数据库这里主要带大家看一下 Mysql 的几个问题</p> <h3 id="存储引擎">存储引擎</h3> <table><thead><tr><th>attr</th> <th>MyISAM</th> <th>InnoDB</th></tr></thead> <tbody><tr><td>Locking</td> <td>Table-level</td> <td>Row-level</td></tr> <tr><td>designed for</td> <td>need of speed</td> <td>high volume of data</td></tr> <tr><td>foreign keys</td> <td>× (DBMS)</td> <td>✓ (RDBMS)</td></tr> <tr><td>transaction</td> <td>×</td> <td>✓</td></tr> <tr><td>fulltext search</td> <td>✓</td> <td>×</td></tr> <tr><td>scene</td> <td>lots of select</td> <td>lots of insert/update</td></tr> <tr><td>count rows</td> <td>fast</td> <td>slow</td></tr> <tr><td>auto_increment</td> <td>fast</td> <td>slow</td></tr></tbody></table> <ul><li>你的数据库有外键吗？</li> <li>你需要事务支持吗？</li> <li>你需要全文索引吗？</li> <li>你经常使用什么样的查询模式？</li> <li>你的数据有多大？</li></ul> <p>参见 <a href="http://coolshell.cn/articles/652.html" target="_blank" rel="noopener noreferrer">MYSQL: INNODB 还是 MYISAM?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="索引">索引</h3> <p>索引是用空间换时间的一种优化策略. 推荐阅读: <a href="http://www.cnblogs.com/cq-home/p/3482101.html" target="_blank" rel="noopener noreferrer">mysql索引类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 以及 <a href="http://blog.mimvp.com/2015/03/the-difference-between-primary-key-and-unique-index/" target="_blank" rel="noopener noreferrer">主键与唯一索引的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="mongodb">Mongodb</h2> <blockquote><p>Monogdb 连接问题(超时/断开等)有可能是什么问题导致的?</p></blockquote> <ul><li>网络问题</li> <li>任务跑不完, 超过了 driver 的默认链接超时时间 (如 30s)</li> <li>Monogdb 宕机了</li> <li>超过了连接空闲时间 (connection idle time) 被断开</li> <li>fd 不够用 (ulimit 设置)</li> <li>mongodb 最大连接数不够用 (可能是连接未复用导致)</li> <li>etc...</li></ul> <h3 id="other">other</h3> <p>populate</p> <p>aggregate</p> <p>pipeline</p> <p>Cursor</p> <p>整理中</p> <h2 id="replication">Replication</h2> <blockquote><p>备份数据库与 M/S, M/M 等部署方式的区别?</p></blockquote> <p>关于数据库基于各种模式的特点全部可以通过以下图片分清:</p> <p><img src="/assets/storage.jpeg" alt="storage"></p> <p>图片出处：Google App Engine 的 co-founder Ryan Barrett 在 2009 年的 google i/o 上的演讲 <a href="http://snarfed.org/transactions_across_datacenters_io.html" target="_blank" rel="noopener noreferrer">《Transaction Across DataCenter》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（视频： http://www.youtube.com/watch?v=srOgpXECblk）</p> <p>根据上图, 我们可以知道  Master/Slave 与 Master/Master 的关系.</p> <table><tr><th>attr</th><th>Master/Slave</th><th>Master/Master</th></tr> <tr><td>一致性</td><td colspan="2">Eventually：当你写入一个新值后，有可能读不出来，但在某个时间窗口之后保证最终能读出来。比如：DNS，电子邮件、Amazon S3，Google搜索引擎这样的系统。</td></tr> <tr><td>事务</td><td align="center">完整</td><td align="center">本地</td></tr> <tr><td>延迟</td><td colspan="2" align="center">低延迟</td></tr> <tr><td>吞吐</td><td colspan="2" align="center">高吞吐</td></tr> <tr><td>数据丢失</td><td colspan="2" align="center">部分丢失</td></tr> <tr><td>熔断</td><td align="center">只读</td><td align="center">读/写</td></tr></table> <h3 id="读写分离">读写分离</h3> <p>读写分离是在 query 量大的情况下减轻单个 DB 节点压力, 优化数据库读/写速度的一种策略. 不论是 MySQL 还是 MongoDB 都可以进行读写分离.</p> <p>读写分离的配置方式直接搜索一下 <code>数据库名 + 读写分离</code> 即可找到. 通常是 M/S 的情况, 使用 Master 专门写, 用 Slave 节点专门读. 使用读写分离时, 请确认读的请求对一致性要求不高, 因为从写库同步读库是有延迟的.</p> <h2 id="数据一致性">数据一致性</h2> <p>关于数据一致性推荐看陈皓的<a href="http://www.infoq.com/cn/articles/distributed-system-transaction-processing" target="_blank" rel="noopener noreferrer">分布式系统的事务处理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>什么情况下数据会出现脏数据? 如何避免?</p></blockquote> <ul><li>从 A 帐号中把余额读出来</li> <li>对 A 帐号做减法操作</li> <li>把结果写回 A 帐号中</li> <li>从 B 帐号中把余额读出来</li> <li>对 B 帐号做加法操作</li> <li>把结果写回 B 帐号中</li></ul> <p>为了数据的一致性, 这6件事, 要么都成功做完, 要么都不成功, 而且这个操作的过程中, 对A、B帐号的其它访问必需锁死, 所谓锁死就是要排除其它的读写操作, 否则就会出现脏数据 ---- 即数据一致性的问题.</p> <p>这个问题并不仅仅出现在数据库操作中, 普通的并发以及并行操作都可能导致出现脏数据. 避免出现脏数据通常是从架构上避免或者采用事务的思想处理.</p> <h3 id="矛盾">矛盾</h3> <ul><li>1）要想让数据有高可用性，就得写多份数据</li> <li>2）写多份的问题会导致数据一致性的问题</li> <li>3）数据一致性的问题又会引发性能问题</li></ul> <p>强一致性必然导致性能短板, 而弱一致性则有很好的性能但是存在数据安全(灾备数据丢失)/一致性(脏读/脏写等)的问题.</p> <p>目前 Node.js 业内流行的主要是与 Mongodb 配合, 在数据一致性方面属于短板.</p> <h3 id="事务">事务</h3> <p>事务并不仅仅是 sql 数据库中的一个功能, 也是分布式系统开发中的一个思想, 事务在分布式的问题中可以称为 &quot;两阶段提交&quot; (以下引用陈皓原文)</p> <p>第一阶段：</p> <ul><li>协调者会问所有的参与者结点，是否可以执行提交操作。</li> <li>各个参与者开始事务执行的准备工作：如：为资源上锁，预留资源，写undo/redo log……</li> <li>参与者响应协调者，如果事务的准备工作成功，则回应“可以提交”，否则回应“拒绝提交”。</li></ul> <p>第二阶段：</p> <ul><li>如果所有的参与者都回应“可以提交”，那么，协调者向所有的参与者发送“正式提交”的命令。参与者完成正式提交，并释放所有资源，然后回应“完成”，协调者收集各结点的“完成”回应后结束这个Global Transaction。</li> <li>如果有一个参与者回应“拒绝提交”，那么，协调者向所有的参与者发送“回滚操作”，并释放所有资源，然后回应“回滚完成”，协调者收集各结点的“回滚”回应后，取消这个Global Transaction。</li></ul> <p>异常:</p> <ul><li>如果第一阶段中，参与者没有收到询问请求，或是参与者的回应没有到达协调者。那么，需要协调者做超时处理，一旦超时，可以当作失败，也可以重试。</li> <li>如果第二阶段中，正式提交发出后，如果有的参与者没有收到，或是参与者提交/回滚后的确认信息没有返回，一旦参与者的回应超时，要么重试，要么把那个参与者标记为问题结点剔除整个集群，这样可以保证服务结点都是数据一致性的。</li> <li>第二阶段中，如果参与者收不到协调者的commit/fallback指令，参与者将处于“状态未知”阶段，参与者完全不知道要怎么办。</li></ul> <h2 id="缓存">缓存</h2> <blockquote><p>redis 与 memcached 的区别?</p></blockquote> <table><thead><tr><th>attr</th> <th>memcached</th> <th>redis</th></tr></thead> <tbody><tr><td>struct</td> <td>key/value</td> <td>key/value + list, set, hash etc.</td></tr> <tr><td>backup</td> <td>×</td> <td>✓</td></tr> <tr><td>Persistence</td> <td>×</td> <td>✓</td></tr> <tr><td>transcations</td> <td>×</td> <td>✓</td></tr> <tr><td>consistency</td> <td>strong (by cas)</td> <td>weak</td></tr> <tr><td>thread</td> <td>multi</td> <td>single</td></tr> <tr><td>memory</td> <td>physical</td> <td>physical &amp; swap</td></tr></tbody></table> <h2 id="其他">其他</h2> <ul><li>zookeeper</li> <li>kafka</li> <li>storm</li> <li>hadoop</li> <li>spark</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/zhenquan321/edit/master/src/node/storage.md" target="_blank" rel="noopener noreferrer">Found a bug? Help me improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/node/util.html" class="prev">
          util
        </a></span> <span class="next"><a href="/node/security.html">
          安全
        </a>
        →
      </span></p></div> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.239b68c1.js" defer></script><script src="/assets/js/4.d46d2a2b.js" defer></script><script src="/assets/js/72.ae7c169f.js" defer></script>
  </body>
</html>
